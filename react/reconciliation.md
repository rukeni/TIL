# 리액트 DIFFING ALGORITHMS

두 개의 트리를 비교할 때, 두 엘리멘트의 루트 엘리먼트부터 비교를 시작한다.

## 엘리먼트의 타입이 다른 경우

두 루트 엘리먼트의 타입이 다르면, 리액트는 이전 트리를 버리고 완전히 새로운 트리를 구축한다.

예를들어서, `a`태그가 `img`로 바뀌거나 `Article` 컴포넌트가 `Comment`컴포넌트로 바뀌고 `Button`컴포넌트가 `div`로 바뀌는 것이다.

트리를 버릴때 이전 DOM 노드들은 모두 파괴된다.

이전 트리와 연관된 모든 스테이트는 사라진다.

## 엘리먼트의 타입이 같은 경우

같은 타입의 두 React DOM 엘리먼트를 비교할 때, 리액트는 두 엘리먼트의 속성을 확인하여, 동일한 내용은 유지하고 변경된 속성들만 갱신한다.

예를 들어,

```jsx
<div className="before" title="stuff" />

<div className="after" title="stuff" />
```

이 두 엘리먼트를 비교하면 현재 DOM 노드 상에 className만 수정한다.

DOM 노드의 처리가 끝나면, React는 이어서 해당 노드의 자식들을 재귀적으로 처리한다.

## 같은 타입의 컴포넌트 엘리먼트

컴포넌트가 갱신되면 인스턴스는 동일하게 유지되어 렌더링 간 state가 유지된다.

React는 새로운 엘리먼트의 내용을 반영하기 위해 현재 컴포넌트 인스턴스의 props를 갱신한다.

다음으로 render() 메서드가 호출되고 비교 알고리즘이 이전 결과와 새로운 겨로가를 재귀적으로 처리한다.

## 자식에 대한 재귀적 처리

두개의 자식 리스트를 순회하고 차이점이 있으면 생성한다.

단순히는 변경 되면 모두 갈아 끼워진다.

이때 key 속성을 사용하면 기존 트리에 존재하는 key라면 식별자로 작용하여 트리 변환이 효율적으로 실행될 수 있다.

해당 키는 오로지 형제 사이에서만 유일하면 되며, 전역에서는 유일할 필요 없다.

배열의 인덱스의 경우 재배열되는 경우 인덱스가 바뀌므로 비효율적으로 동작할 것이다.

## 고려해야하는 점

형제끼리만 키로 비교하기때문에 아예 다른 형제로 이관되는 경우는 표현할 수 없다.

키는 반드시 변하지 않고 예상 가능해야하며 유일해야 한다.
